<form class="flex flex-col gap-2 compact-form" [formGroup]="form">

  <div class="text-secondary text-sm my-2">
    The BETTER analysis leverages better.lbl.gov to calculate energy, cost, and GHG emission savings by comparing the
    property's change point model with a benchmarked model. The results include saving potential and a list of recommended
    high-level energy conservation measures.
    <mat-divider class="mt-2"></mat-divider>

  </div>

  <div class="flex gap-4">
    <mat-form-field class="flex-1 no-sub">
      <mat-label>Savings Target</mat-label>
      <mat-select formControlName="savings_target">
        @for (option of savingsTargets; track option) {
          <mat-option [value]="option" class="compact-form">{{ option }}</mat-option>
        }
      </mat-select>
    </mat-form-field>
  
    <mat-form-field class="flex-1 no-sub">
      <mat-label>Benchmark Data Type</mat-label>
      <mat-select formControlName="benchmark_data_type">
        @for (option of benchmarkDataTypes; track option) {
          <mat-option [value]="option" class="compact-form">{{ option }}</mat-option>
        }
      </mat-select>
    </mat-form-field>

    <mat-form-field class="flex-1 no-sub">
      <mat-label>Min Model RÂ²</mat-label>
      <input matInput formControlName="min_model_r_squared">
    </mat-form-field>
  </div>


  <div class="flex gap-4 mt-1">
    <mat-checkbox formControlName="preprocess_meters" >
      Preprocess Meters
    </mat-checkbox>
    @if (viewIds.length > 1) {
      <mat-checkbox formControlName="portfolio_analysis" >
        Portfolio Analysis
      </mat-checkbox>
    }
  </div>

  <mat-button-toggle-group formControlName="select_meters" class="mt-2 border-button-toggle-group">
    <mat-button-toggle value="select_cycle">Cycle</mat-button-toggle>
    <mat-button-toggle value="date_range">Meter Data Range</mat-button-toggle>
    <mat-button-toggle value="all">All Meter Data</mat-button-toggle>
  </mat-button-toggle-group>

  @if (form.value.select_meters === 'select_cycle') {
    <mat-form-field class="flex-1">
      <mat-label>Cycle</mat-label>
      <mat-select formControlName="cycle_id">
        @for (cycle of cycles; track cycle) {
          <mat-option [value]="cycle.id">{{ cycle.name }}</mat-option>
        }
      </mat-select>
    </mat-form-field>
  } @else if (form.value.select_meters === 'date_range') {
    <div class="flex gap-4 mt-2" formGroupName="meter" >
      <mat-form-field class="flex-1">
        <mat-label>Start Date</mat-label>
        <input matInput [matDatepicker]="startDatePicker" formControlName="start_date">
        <mat-datepicker-toggle matSuffix [for]="startDatePicker"></mat-datepicker-toggle>
        <mat-datepicker #startDatePicker></mat-datepicker>
      </mat-form-field>

      <mat-form-field class="flex-1">
        <mat-label>End Date</mat-label>
        <input matInput [matDatepicker]="endDatePicker" formControlName="end_date">
        <mat-datepicker-toggle matSuffix [for]="endDatePicker"></mat-datepicker-toggle>
        <mat-datepicker #endDatePicker></mat-datepicker>
      </mat-form-field>
    </div>
  }
</form>